<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head><title>DDrive - A lightweight cloud storage system using discord as storage device written in nodejs.</title>
    <meta charset="utf-8">
    <meta property="og:title" content="DDrive" />
    <meta property="og:url" content="https://disfs.herokuapp.com/" />
    <meta property="og:image" content="https://cdn.discordapp.com/attachments/824744543231934535/833395615974948864/favicon-1.png" />
    <meta property="og:description" content="Store and share any size of file over Discord forever!" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="icon" type="image/x-icon" href="/favicon.ico"/>
    <link href="https://fonts.googleapis.com/css2?family=Dela+Gothic+One&family=Press+Start+2P&family=Zilla+Slab+Highlight:wght@700&display=swap"
          rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
        }

        body {
            overflow-x: hidden;
            background-color: #0d1117;
        }

        div.main {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px 20px 0;
            color: #c9d1d9
        }
        div.container {
            height: fit-content;
            max-width: 40rem;
            display: flex;
            padding: 0 0 0 0;
            flex-direction: column;
            position: relative;
            top: 5rem;
            bottom: 0;
            right: 0;
            left: 0;
            border-radius: 0.5rem;
            margin: auto 3rem;
            border: 1px solid #30363d;
            align-items: stretch;
        }

        div.header {
            display: flex;
            flex-direction: row;
            height: 2.2rem;
            align-items: center;
            justify-content: flex-end;
            border-bottom: 1px solid #30363d;
        }

        div.footer {
            display: flex;
            flex-direction: row;
            height: 1.6rem;
            margin-top: auto;
            align-items: center;
            border-top: 1px solid #30363d;
        }

        button.upload, button.delete {
            color: #c9d1d9;
            border: 1px solid #30363d;
            background-color: #21262c;
            border-radius: 0.3rem;
            height: 1.6rem;
            width: 9rem;
            margin-right: 0.5rem;
            font-size: 13px;
        }
        button.delete {
            color: #f8283b;
        }
        button:hover {
            background-color: #3a3e46;
        }

        div.folder {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            height: 2.2rem;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-evenly;
            border-bottom: 1px solid #30363d;
            background-color: transparent;
        }

        div.folder:hover, div.files:hover {
            background-color: #2d323a;
        }

        div.files {
            height: 2.2rem;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: space-evenly;
            border-bottom: 1px solid #30363d;
        }

        a.name-of-file, a.name-of-folder {
            text-decoration: none;
            color: #c9d1d9;
            width: 40%;
            text-align: left;
            position: relative;
            right: 1.3rem;
            font-size: 14px;
            /*right: 1.3rem;*/
        }

        p.time-stamp {
            width: 30%;
            color: #c9d1d9;
            text-align: right;
            font-size: 14px;
        }

        i {
            padding-top: 0.15rem;
            position: relative;
            right: 2rem;
            width: 2%;
            z-index: 5555;
        }

        i img {
            z-index: 555;
        }

        #file-search-label {
            color: #c9d1d9;
            font-size: 14px;
            margin-left: 1rem;
        }

        #file-search:focus{
            outline: none;
        }
        #file-search {
            color: #c9d1d9;
            border: 0 solid #30363d;
            background-color: #21262c;
            /*border-radius: 0.3rem;*/
            height: 1.6rem;
            width: 100%;
            margin-left: 20px;
            font-size: 13px;
        }

        #current-path{
            color: #c9d1d9;
        }
        ul.breadcrumb {
            padding: 10px 16px;
            list-style: none;
            alignment: bottom;
            font-weight: bold;
            width: 100%;
            /*background-color: #eee;*/
        }
        ul.breadcrumb li {
            display: inline;
            font-size: 14px;
        }
        ul.breadcrumb li+li:before {
            padding: 2px;
            color: #9399a2;
            content: "/";
        }
        ul.breadcrumb li a {
            color: #58a6ff;
            text-decoration: none;
        }
        ul.breadcrumb li a:hover {
            color: #01447e;
            text-decoration: underline;
        }

        @media screen and (min-width: 730px) {
            div.container {
                margin: auto;
                /*color: #f8283b;*/
            }
        }

        @media screen and (min-width: 768px) {
            a.name-of-file, a.name-of-folder {
                position: relative;
                right: 3.5rem;
            }

            i {
                position: relative;
                right: 2rem;
            }
        }

    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <ul class="breadcrumb">
            {{PATH_PLACE_HOLDER}}
        </ul>
        <button class="delete">Delete Directory</button>
    </div>
    {{DIRECTORY_ENTRIES}}
    {{FILE_ENTRIES}}
    <div class="footer">
        <label for="file-search" id="file-search-label">Search</label>
        <input type="search" id="file-search" name="q" aria-label="Search through site content">
    </div>
</div>
<script>
    const progress_bar = document.getElementById('progress_bar')
    const progress_bar_label = document.getElementById('progress_bar_label')
    const message = document.getElementById('message')
    const deleteFileName = document.getElementById('deleteFileName')
    const deleteMessage = document.getElementById('deleteMessage')

    function humanFileSize(bytes, si=false, dp=1) {
        const thresh = si ? 1000 : 1024;

        if (Math.abs(bytes) < thresh) {
            return bytes + ' B';
        }

        const units = si
            ? ['kB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB']
            : ['KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];
        let u = -1;
        const r = 10**dp;

        do {
            bytes /= thresh;
            ++u;
        } while (Math.round(Math.abs(bytes) * r) / r >= thresh && u < units.length - 1);


        return bytes.toFixed(dp) + ' ' + units[u];
    }

    function setDeleteErrorMessage(msg){
        deleteMessage.innerText = msg
        message.style.color = '#f8283b'
    }
    function setDeleteMessage(msg) {
        deleteMessage.innerText = msg
    }
    function deleteFile() {
        const xhr = new XMLHttpRequest()
        const path = location.href.replace(/\/$/, '') + '/' + deleteFileName.value
        xhr.open('DELETE', path, true)
        xhr.onload = function () {
            if (xhr.status !== 200) {
                setDeleteErrorMessage(`[Error] ${xhr.responseText}`)
            }else {
                window.location.reload()
            }
        }
        xhr.onerror = function () {
            hideProgress()
            window.location.reload()
        }
        xhr.send()
        deleteMessage.innerText = '[Info] Please wait while file is being deleted'
    }

    function setMessage(msg) {
        message.innerText = msg
    }

    function setErrorMessage(msg){
        message.innerText = msg
        message.style.color = '#f8283b'
    }
    function setProgress(loaded, total) {
        const progress = (total === 0) ? 0 : loaded / total * 100
        progress_bar.value = progress
        setMessage(humanFileSize(loaded) + '(' + progress.toFixed(2) + '%)')
    }

    function hideProgress() {
        progress_bar.style.display = 'none'
        progress_bar_label.style.display = 'none'
    }

    function send() {
        // Select body (text or file)
        const body = window.file_input.files[0]

        // Send
        const xhr = new XMLHttpRequest()
        const path = location.href.replace(/\/$/, '') + '/' + body.name
        xhr.open('POST', path, true)

        // Update progress bar
        xhr.upload.onprogress = function (e) {
            setProgress(e.loaded, e.total)
        }
        xhr.upload.onload = function (e) {
            // Send finished
            if (xhr.status === 200) {
                setProgress(e.loaded, e.total)
            }
        }
        xhr.onload = function () {
            // Status code error
            if (xhr.status !== 200) {
                setErrorMessage(`[Error] ${xhr.responseText}`)
                hideProgress()
            }else {
                window.location.reload()
            }
        }
        xhr.onerror = function () {
            hideProgress()
            window.location.reload()
        }
        xhr.send(body)
        // Show progress bar
        progress_bar.style.removeProperty('display')
        progress_bar_label.style.removeProperty('display')
    }

</script>
</body>
</html>
